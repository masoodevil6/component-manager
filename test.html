<!--<!DOCTYPE html>
<html>
<head>
  <title>اسکن QR با CDN</title>
  <script src="./html5-qrcode.min.js"></script>
</head>
<body>

<h3>اسکن QR Code با دوربین</h3>

<input type="file" id="file-input" accept="image/*" />
<div id="reader"></div>
<script>
  const qr = new Html5Qrcode("reader");
  document.getElementById("file-input").addEventListener("change", e => {
    if (e.target.files.length === 0) return;
    qr.scanFile(e.target.files[0], true)
            .then(decodedText => {
              console.log("محتوای QR:", decodedText);
            })
            .catch(err => {
              console.error("خطا در اسکن فایل:", err);
            });
  });
</script>






<script>


  const scanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
  scanner.render(
          decodedText => {
            document.getElementById("result").innerText = "محتوای QR: " + decodedText;
            scanner.clear();
          },
          error => {
            // خطاهای اسکن را سرکوب کن
          }
  );

</script>

</body>
</html>-->
<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>آپلود و خواندن QR Code</title>
  <style>
    #drop-area {
      border: 2px dashed #ccc;
      padding: 30px;
      text-align: center;
      color: #666;
      margin-bottom: 20px;
      border-radius: 10px;
      cursor: pointer;
    }
    #drop-area.hover {
      border-color: #333;
      background: #f0f0f0;
    }
    #file-input {
      display: none;
    }
    #result {
      font-family: monospace;
      color: green;
      margin-top: 10px;
    }
  </style>
 <!-- <script src="./html5-qrcode.min.js"></script>-->
</head>
<body>

<h2>آپلود یا درگ کن QR Code</h2>

<div id="drop-area"
     ondragover="event.preventDefault()"
     ondragenter="event.preventDefault(); this.classList.add('hover')"
     ondragleave="this.classList.remove('hover')"
     ondrop="drag(event)">
  فایل رو بکش اینجا
</div>

<!--<div id="drop-area" ondrag="drag()">فایل QR را بکش و رها کن یا کلیک کن برای انتخاب</div>-->
<input type="file" id="file-input" accept="image/*">

<div id="result">نتیجه: <span id="qr-result">—</span></div>

<script>
  const dropArea = document.getElementById("drop-area");
  const fileInput = document.getElementById("file-input");
  const qrResult = document.getElementById("qr-result");
  //const html5Qr = new Html5Qrcode();

  // 🛡 جلوگیری از باز شدن فایل در تب جدید (بسیار مهم)
  document.addEventListener("dragover", e => e.preventDefault());
  document.addEventListener("drop", e => e.preventDefault());

  // رویدادهای مربوط به ناحیه drop
  dropArea.addEventListener("dragenter", e => {
    e.preventDefault();
    dropArea.classList.add("hover");
  });

  dropArea.addEventListener("dragover", e => {
    e.preventDefault();
    dropArea.classList.add("hover");
  });

  dropArea.addEventListener("dragleave", e => {
    e.preventDefault();
    dropArea.classList.remove("hover");
  });

 /* dropArea.addEventListener("drop", e => {
    e.preventDefault();
    dropArea.classList.remove("hover");

    const files = e.dataTransfer.files;

    if (files.length > 0) {
      handleFile(files[0]);
    }
  });*/

  function drag(e){
    console.log(e)
    e.preventDefault();
    dropArea.classList.remove("hover");

    const files = e.dataTransfer.files;

    if (files.length > 0) {
      handleFile(files[0]);
    }
  }


  // کلیک برای انتخاب فایل
  dropArea.addEventListener("click", () => fileInput.click());

  fileInput.addEventListener("change", () => {
    if (fileInput.files.length > 0) {
      handleFile(fileInput.files[0]);
    }
  });

  function handleFile(file) {
    /*html5Qr.scanFile(file, true)
            .then(decodedText => {
              qrResult.innerText = decodedText;
            })
            .catch(err => {
              qrResult.innerText = "خطا: " + err;
            });*/
  }
</script>

</body>
</html>

